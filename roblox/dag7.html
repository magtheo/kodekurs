<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dag 7 - Roblox Studio Kodekurs</title>
    <link rel="stylesheet" href="../styles.css">
    <style>
        /* Sm√• UI-forbedringer for Dag 7 */
        .pill { display:inline-block; padding:6px 10px; border-radius:999px; background:#eef5ff; font-size:0.9rem; margin-right:8px; }
        .grid { display:grid; gap:16px; }
        .grid-2 { grid-template-columns: 1fr; }
        @media (min-width: 900px){ .grid-2 { grid-template-columns: 1fr 1fr; } }
        .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,0.04); }
        .kode { background:#0b1020; color:#e9f0ff; border-radius:10px; padding:16px; overflow:auto; font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; line-height:1.4; }
        .callout { border-left:4px solid #6aa6ff; background:#f5f9ff; padding:12px 14px; border-radius:8px; }
        .danger { border-left:4px solid #ff6a6a; background:#fff5f5; }
        .success { border-left:4px solid #29b36a; background:#f3fff8; }
        .warning { border-left:4px solid #ffa500; background:#fff9f0; }
        .subtitle { max-width:60ch; }
        .legend { display:flex; flex-wrap:wrap; gap:8px; margin:12px 0; }
        ol.stepper { counter-reset: step; list-style: none; padding-left: 0; }
        ol.stepper > li { counter-increment: step; margin: 0 0 14px 0; background:#fafafa; border:1px solid #eee; border-radius:10px; padding:12px 14px; }
        ol.stepper > li::before { content: counter(step); display:inline-flex; align-items:center; justify-content:center; width:28px; height:28px; border-radius:50%; background:#2c5cff; color:#fff; font-weight:700; margin-right:10px; }
        .prop { background:#f7f7ff; border:1px dashed #cdd1ff; border-radius:8px; padding:8px 10px; margin-top:10px; }
        .mini { font-size:0.95rem; color:#334; }
        .task-list li { margin-bottom:8px; }
        .concept-badge { font-weight:600; color:#2c5cff; }
        .tight { margin-top: 6px; margin-bottom: 0; }

        /* --- Kopier-knapp for kodesnutt --- */
        .code-wrap { position: relative; }
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 6px 10px;
            border: 1px solid #d9e2ff;
            background: #f3f6ff;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .copy-btn:hover { background:#e9efff; }
        .copy-btn:active { transform: translateY(1px); }
        .copy-btn:focus { outline: 2px solid #2c5cff; outline-offset: 2px; }

        .tree-structure {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            white-space: pre;
            overflow-x: auto;
            border-radius: 5px;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            margin-right: 10px;
            font-weight: bold;
        }

        .property-list {
            list-style: none;
            padding-left: 0;
        }

        .property-list li {
            background: white;
            margin: 8px 0;
            padding: 10px 15px;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }

        .property-list li strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìÖ Dag 7: Eple-plukking og spisesystem</h1>
            <p class="subtitle">I dag lager vi et komplett system hvor spillere kan plukke opp epler som faller fra tr√¶r, og spise dem for √• f√• helse tilbake!</p>
            <div class="legend">
                <span class="pill">Tools</span>
                <span class="pill">ProximityPrompt</span>
                <span class="pill">RemoteEvent</span>
                <span class="pill">ServerStorage</span>
                <span class="pill">Clone()</span>
                <span class="pill">Humanoid.Health</span>
            </div>
        </header>

        <nav class="nav">
            <a href="../index.html">üè† Hjem</a>
            <a href="index.html">Roblox Oversikt</a>
            <details class="dropdown-nav">
                <summary>Dager</summary>
                <div class="dropdown-content">
                    <a href="dag1.html">Dag 1</a>
                    <a href="dag2.html">Dag 2</a>
                    <a href="dag3.html">Dag 3</a>
                    <a href="dag4.html">Dag 4</a>
                    <a href="dag5.html">Dag 5</a>
                    <a href="dag6.html">Dag 6</a>
                    <a href="dag7.html" class="active">Dag 7</a>
                    <a href="dag8.html">Dag 8</a>
                    <a href="dag9.html">Dag 9</a>
                    <a href="dag10.html">Dag 10</a>
                    <a href="dag11.html">Dag 11</a>
                    <a href="dag12.html">Dag 12</a>
                    <a href="dag13.html">Dag 13</a>
                    <a href="dag14.html">Dag 14</a>
                    <a href="dag15.html">Dag 15</a>
                    <a href="dag16.html">Dag 16</a>
                </div>
            </details>
        </nav>

        <main>
            <!-- M√•l -->
            <section class="concept card">
                <h2>üéØ M√•l for dagen</h2>
                <ul class="task-list">
                    <li>Lage et <strong>eple</strong> i verden som faller fra et tre etter tilfeldig tid.</li>
                    <li>Bruke <strong>ProximityPrompt</strong> s√• spilleren kan plukke opp eplet.</li>
                    <li>Gi spilleren et <strong>Tool</strong> (eple) som de kan holde i h√•nden.</li>
                    <li>La spilleren <strong>spise</strong> eplet for √• f√• tilbake helse (+20 HP).</li>
                    <li>Bruke <strong>RemoteEvent</strong> for kommunikasjon mellom klient og server.</li>
                </ul>
                <div class="callout success mini">
                    <strong>Resultat:</strong> Et komplett item-system med plukking, bruk, og effekt!
                </div>
            </section>

            <!-- Oppsett oversikt -->
            <section class="card">
                <h2>üì¶ Komplett oppsett - Oversikt</h2>
                <p class="mini">F√∏r vi begynner, se p√• den komplette strukturen. Dette er det vi skal bygge i dag:</p>
                
                <div class="tree-structure">ReplicatedStorage
‚îî‚îÄ EatApple (RemoteEvent)

ServerStorage
‚îî‚îÄ Apple (Tool)
   ‚îú‚îÄ Handle (Part) [Anchored=false, CanCollide=false, Shape=Ball]
   ‚îú‚îÄ Crunch (Sound) [valgfritt]
   ‚îî‚îÄ LocalScript

ServerScriptService
‚îî‚îÄ EatAppleHandler (Script)

Workspace
‚îî‚îÄ AppleWorld (Part) [Anchored=true ved start]
   ‚îî‚îÄ Script</div>

                <div class="callout mini">
                    <strong>Enkelt forklart:</strong> Et eple faller fra et tre ‚Üí spilleren plukker det opp ‚Üí f√•r et Tool ‚Üí klikker for √• spise ‚Üí f√•r helse!
                </div>
            </section>

            <!-- Trinnvis: bygge i Studio -->
            <section class="card">
                <h2>üß± Del 1: Lag eple-verkt√∏yet (Tool)</h2>
                <p class="mini">Dette er malen som spilleren f√•r n√•r de plukker opp eplet.</p>

                <h3><span class="step-number">1</span> Opprett Tool i ServerStorage</h3>
                <ol class="stepper">
                    <li>
                        √Öpne <strong>ServerStorage</strong> i Explorer.
                        <div class="prop mini">
                            <p class="tight"><strong>H√∏yreklikk ServerStorage</strong> ‚Üí Insert Object ‚Üí <strong>Tool</strong></p>
                            <p class="tight"><strong>Navn:</strong> <code>AppleTool</code></p>
                        </div>
                    </li>
                    <li>
                        Lag en <strong>Handle</strong> (Part) inne i AppleTool.
                        <div class="prop mini">
                            <p class="tight"><strong>VIKTIG:</strong> Den M√Ö hete <code>Handle</code> (med stor H)</p>
                            <p class="tight"><strong>Anchored:</strong> <code>false</code></p>
                            <p class="tight"><strong>CanCollide:</strong> <code>false</code></p>
                            <p class="tight"><strong>Shape:</strong> <code>Ball</code></p>
                            <p class="tight"><strong>Size:</strong> <code>0.7, 0.7, 0.7</code></p>
                            <p class="tight"><strong>Color:</strong> R√∏d eller gr√∏nn (som et eple)</p>
                            <p class="tight"><strong>Material:</strong> SmoothPlastic eller Neon</p>
                        </div>
                    </li>
                    <li>
                        (Valgfritt) Legg til en <strong>Sound</strong> i AppleTool for "crunch"-lyd.
                        <div class="prop mini">
                            <p class="tight"><strong>Navn:</strong> <code>Crunch</code></p>
                            <p class="tight"><strong>SoundId:</strong> Lim inn en lyd-ID (f.eks. fra Roblox Library)</p>
                        </div>
                    </li>
                </ol>

                <h3><span class="step-number">2</span> LocalScript i AppleTool</h3>
                <p class="mini">Dette scriptet sender en beskjed til serveren n√•r spilleren aktiverer Tool.</p>

                <div class="code-wrap">
                    <button class="copy-btn" data-target="#code-appletool" aria-label="Kopier koden">Kopier</button>
                    <pre class="kode"><code id="code-appletool" class="language-lua">-- LocalScript under AppleTool
-- LocalScript under Apple Tool
local tool = script.Parent
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local EatAppleEvent = ReplicatedStorage:WaitForChild("EatApple")

-- Debounce s√• vi ikke skyter mange ganger pr klikk
local canUse = true

local function updateTooltip()
	local stack = tool:GetAttribute("Stack") or 1
	tool.ToolTip = ("Eple x%d ‚Äì klikk for √• spise"):format(stack)
end

tool:GetAttributeChangedSignal("Stack"):Connect(updateTooltip)
updateTooltip()

tool.Activated:Connect(function()
	if not canUse then return end
	local stack = tool:GetAttribute("Stack") or 0
	if stack <= 0 then return end

	canUse = false
	local player = Players.LocalPlayer
	if not player then
		canUse = true
		return
	end

	-- Be server om √• spise ett eple
	EatAppleEvent:FireServer()

	-- Kort lokal cooldown (matcher server-delay)
	task.delay(0.35, function()
		canUse = true
	end)
end)

tool.Equipped:Connect(function()
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = "üçé Eple";
		Text = "Klikk for √• spise. Stacks: " .. (tool:GetAttribute("Stack") or 1);
		Duration = 2
	})
end)
</code></pre>
                </div>
                
                <div class="callout mini" style="margin-top: 12px;">
                    <strong>Hva gj√∏r denne koden?</strong> N√•r spilleren klikker med eplet, sendes en melding til serveren. Vi viser ogs√• en liten notifikasjon n√•r eplet holdes i h√•nden.
                </div>
            </section>

            <section class="card">
                <h2>üß± Del 2: Kommunikasjon (RemoteEvent)</h2>

                <h3><span class="step-number">3</span> Opprett RemoteEvent</h3>
                <ol class="stepper">
                    <li>
                        √Öpne <strong>ReplicatedStorage</strong> i Explorer.
                        <div class="prop mini">
                            <p class="tight"><strong>H√∏yreklikk ReplicatedStorage</strong> ‚Üí Insert Object ‚Üí <strong>RemoteEvent</strong></p>
                            <p class="tight"><strong>Navn:</strong> <code>EatApple</code></p>
                        </div>
                    </li>
                </ol>

                <div class="callout mini">
                    <strong>Hvorfor RemoteEvent?</strong> LocalScript (klient) kan ikke endre spillerens helse direkte. Vi m√• sende en beskjed til serveren som gj√∏r endringen.
                </div>
            </section>

            <section class="card">
                <h2>üß± Del 3: Server-side logikk</h2>

                <h3><span class="step-number">4</span> ServerScript i ServerScriptService</h3>
                <p class="mini">Dette scriptet lytter etter "spis eple"-beskjeden og gir spilleren helse.</p>

                <div class="code-wrap">
                    <button class="copy-btn" data-target="#code-serverscript" aria-label="Kopier koden">Kopier</button>
                    <pre class="kode"><code id="code-serverscript" class="language-lua">-- ServerScriptService/EatAppleHandler.server.lua
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local EatAppleEvent = ReplicatedStorage:WaitForChild("EatApple")

EatAppleEvent.OnServerEvent:Connect(function(player)
	local char = player.Character
	if not char then return end
	local tool = char:FindFirstChild("Apple")
	if not tool then return end
	local humanoid = char:FindFirstChildOfClass("Humanoid")
	if not humanoid then return end

	local heal = 20
	humanoid.Health = math.min(humanoid.MaxHealth, humanoid.Health + heal)

	local handle = tool:FindFirstChild("Handle")
	if handle then
		local crunch = handle:FindFirstChild("Crunch")
		if crunch then crunch:Play() end
	end

	local stack = tool:GetAttribute("Stack") or 1
	stack -= 1
	tool:SetAttribute("Stack", stack)

	-- Vent litt slik at lyd/heal fullf√∏res
	task.delay(0.5, function()
		if tool and tool.Parent and (tool:GetAttribute("Stack") or 0) <= 0 then
			tool:Destroy()
		end
	end)
end)
</code></pre>
                </div>
                
                <div class="callout mini" style="margin-top: 12px;">
                    <strong>Hva gj√∏r denne koden?</strong> Serveren sjekker at spilleren holder AppleTool, gir 20 helse, spiller crunch-lyd, og sletter eplet.
                </div>
            </section>

            <section class="card">
                <h2>üß± Del 4: Verdens-eple som faller</h2>

                <h3><span class="step-number">5</span> Lag eple i Workspace</h3>
                <ol class="stepper">
                    <li>
                        Sett inn en <strong>Part</strong> i <em>Workspace</em>.
                        <div class="prop mini">
                            <p class="tight"><strong>Navn:</strong> <code>AppleWorld</code> (eller valgfritt)</p>
                            <p class="tight"><strong>Anchored:</strong> <code>true</code> (starter forankret)</p>
                            <p class="tight"><strong>CanCollide:</strong> <code>true</code></p>
                            <p class="tight"><strong>Shape:</strong> <code>Ball</code></p>
                            <p class="tight"><strong>Size:</strong> <code>1, 1, 1</code></p>
                            <p class="tight"><strong>Color:</strong> R√∏d eller gr√∏nn</p>
                            <p class="tight"><strong>Position:</strong> Plasser h√∏yt oppe i et tre</p>
                        </div>
                    </li>
                    <li>
                        Legg til et <strong>Script</strong> inne i denne Part.
                    </li>
                </ol>

                <h3><span class="step-number">6</span> Script for √• falle og gi Tool</h3>

                <div class="code-wrap">
                    <button class="copy-btn" data-target="#code-appledrop" aria-label="Kopier koden">Kopier</button>
                    <pre class="kode"><code id="code-appledrop" class="language-lua">-- Script under verdens-eplet (Part) i Workspace
local Eple = script.Parent
local ServerStorage = game:GetService("ServerStorage")

-- La eplet falle etter 10‚Äì600 sek
local ventetid = math.random(10, 10 * 60)
task.wait(3)
Eple.Anchored = false

-- Prompt
local prompt = Instance.new("ProximityPrompt")
prompt.ActionText = "Plukk opp eple"
prompt.ObjectText = "Eple"
prompt.HoldDuration = 0
prompt.MaxActivationDistance = 12
prompt.Parent = Eple

local DEFAULT_MAX = 20
local DEFAULT_STACK = 1
local pickedUp = false -- server-globalt flagg

local function ensureAttributes(tool)
	if tool:GetAttribute("MaxStack") == nil then tool:SetAttribute("MaxStack", DEFAULT_MAX) end
	if tool:GetAttribute("Stack") == nil then tool:SetAttribute("Stack", DEFAULT_STACK) end
end

local function findAppleTool(player)
	local char = player.Character
	if char then
		local t = char:FindFirstChild("Apple")
		if t then return t end
	end
	return player.Backpack:FindFirstChild("Apple")
end

local function giveTool(player)
	-- Sjekk og l√•s umiddelbart
	if pickedUp then return end
	pickedUp = true
	prompt.Enabled = false -- blokker ekstra triggers

	local template = ServerStorage:FindFirstChild("Apple")
	if not template then
		warn("Apple mangler i ServerStorage")
		return
	end

	local existing = findAppleTool(player)
	if existing then
		ensureAttributes(existing)
		local stack = existing:GetAttribute("Stack") or DEFAULT_STACK
		local max = existing:GetAttribute("MaxStack") or DEFAULT_MAX
		if stack < max then
			existing:SetAttribute("Stack", stack + 1)
		else
			-- kan vise beskjed her
		end
	else
		local tool = template:Clone()
		ensureAttributes(tool)
		tool.Parent = player.Backpack
	end

	-- Fjern delen trygt
	task.defer(function()
		if Eple and Eple.Parent then
			Eple:Destroy()
		end
	end)
end

prompt.Triggered:Connect(giveTool)
</code></pre>
                </div>
                
                <div class="callout mini" style="margin-top: 12px;">
                    <strong>Hva gj√∏r denne koden?</strong> Eplet venter 10 sekunder til 10 minutter, faller ned, lager en "plukk opp"-knapp, og gir spilleren et Tool n√•r de trykker.
                </div>
            </section>

            <!-- Kombinert: flow + konsepter -->
            <section class="card">
                <h2>üß© Slik fungerer systemet - enkelt forklart!</h2>
                <ol class="stepper">
                    <li>
                        <strong>Eplet venter</strong>: Det ligger i et tre og teller ned (10 sek til 10 min)
                    </li>
                    <li>
                        <strong>Eplet faller</strong>: N√•r tiden er ute, slippes eplet og faller til bakken
                    </li>
                    <li>
                        <strong>Du ser en knapp</strong>: N√•r du g√•r n√¶r eplet, ser du "Plukk opp eple" (ProximityPrompt)
                    </li>
                    <li>
                        <strong>Du trykker E</strong>: Serveren gir deg en kopi av AppleTool i ryggsekken din
                    </li>
                    <li>
                        <strong>Du holder eplet</strong>: Velg eplet fra inventory - det dukker opp i h√•nden din
                    </li>
                    <li>
                        <strong>Du klikker</strong>: LocalScript sender melding til serveren: "Jeg vil spise!"
                    </li>
                    <li>
                        <strong>Du blir frisk</strong>: Serveren gir deg +20 helse, spiller "crunch"-lyd
                    </li>
                    <li>
                        <strong>Eplet forsvinner</strong>: Etter 0.4 sekunder slettes Tool fra spillet
                    </li>
                </ol>
                
                <div class="callout success mini">
                    <strong>Viktig √• forst√•:</strong> LocalScript (p√• din PC) kan ikke endre helse direkte - det m√• serveren gj√∏re! Derfor bruker vi RemoteEvent til √• sende beskjed.
                </div>
            </section>

            <section class="grid grid-2">
                <div class="card">
                    <h3>üß™ Mini-oppgaver</h3>
                    <ul class="task-list mini">
                        <li>Endre helse-boost fra 20 til 30.</li>
                        <li>Lag flere epler p√• forskjellige steder.</li>
                        <li>Endre venteTid til <code>math.random(5, 30)</code> for raskere testing.</li>
                        <li>Lag en "gylden eple" som gir 50 helse.</li>
                        <li>Legg til en ParticleEmitter p√• eplet for en "magisk" effekt.</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>üöÄ Videreutvikling</h3>
                    <ul class="task-list mini">
                        <li>Lag et "eple-tre" som respawner nye epler automatisk.</li>
                        <li>Legg til debounce s√• spilleren ikke kan spise flere epler samtidig.</li>
                        <li>Vis en UI-melding n√•r spilleren spiser eplet.</li>
                        <li>Lag et "rotne eple" som tar bort helse i stedet.</li>
                        <li>Tell hvor mange epler spilleren har spist med en Leaderboard.</li>
                    </ul>
                </div>
            </section>

            <section class="card">
                <h2>üõ†Ô∏è Feils√∏king</h2>
                <div class="callout danger mini">
                    <strong>"AppleTool is not a valid member of ServerStorage"</strong><br>
                    Sjekk at Tool heter n√∏yaktig <code>AppleTool</code> (samme store/sm√• bokstaver) og ligger i <em>ServerStorage</em>.
                </div>
                <div class="callout warning mini">
                    <strong>"Handle is not a valid member of Tool"</strong><br>
                    Part-en inne i Tool M√Ö hete <code>Handle</code> (med stor H). Hvis den heter noe annet, vil ikke Tool fungere.
                </div>
                <div class="callout mini">
                    <strong>Eplet faller ikke:</strong> Sjekk at scriptet ligger inne i eplet (Part), og at <code>Anchored</code> starter som <code>true</code>.
                </div>
                <div class="callout mini">
                    <strong>ProximityPrompt vises ikke:</strong> Vent til eplet har falt. Prompten lages f√∏rst etter at <code>Anchored</code> er satt til <code>false</code>.
                </div>
                <div class="callout mini">
                    <strong>Helse endrer seg ikke:</strong> Sjekk at <code>EatApple</code> RemoteEvent ligger i <em>ReplicatedStorage</em> og har riktig navn.
                </div>
            </section>

            <section class="card">
                <h2>üìù Viktige konsepter fra i dag</h2>
                <ul class="task-list">
                    <li><span class="concept-badge">Tool</span> - Et objekt spilleren kan holde i h√•nden</li>
                    <li><span class="concept-badge">Handle</span> - Den synlige delen av et Tool (M√Ö hete "Handle")</li>
                    <li><span class="concept-badge">ProximityPrompt</span> - Viser en melding n√•r spilleren er n√¶r et objekt</li>
                    <li><span class="concept-badge">RemoteEvent</span> - Kommunikasjon mellom klient (LocalScript) og server (Script)</li>
                    <li><span class="concept-badge">Clone()</span> - Lager en kopi av et objekt</li>
                    <li><span class="concept-badge">ServerStorage</span> - Lagring av maler/templates som bare serveren ser</li>
                    <li><span class="concept-badge">Backpack</span> - Spillerens inventory hvor Tools ligger</li>
                </ul>
            </section>

            <div style="text-align: center; margin-top: 40px;">
                <a href="dag6.html" class="day-link" style="margin-right: 20px;">‚Üê Forrige: Dag 6</a>
                <a href="dag8.html" class="day-link">Neste: Dag 8 ‚Üí</a>
            </div>
        </main>

        <footer>
            <p>¬© 2025 Kodekurs for Barn - Roblox-kurset! üåü</p>
        </footer>
    </div>

    <!-- Kopier-knapp logikk -->
    <script>
    (function () {
      function copyText(text) {
        if (navigator.clipboard && window.isSecureContext) {
          return navigator.clipboard.writeText(text);
        } else {
          // Fallback for file:// eller ikke-secure context
          const ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed';
          ta.style.opacity = '0';
          document.body.appendChild(ta);
          ta.focus();
          ta.select();
          try { document.execCommand('copy'); }
          finally { document.body.removeChild(ta); }
          return Promise.resolve();
        }
      }

      document.querySelectorAll('.copy-btn').forEach(function (btn) {
        btn.addEventListener('click', async function () {
          const targetSel = btn.getAttribute('data-target');
          const codeEl = document.querySelector(targetSel);
          const code = codeEl ? codeEl.innerText : '';
          try {
            await copyText(code);
            const old = btn.textContent;
            btn.textContent = 'Kopiert!';
            btn.setAttribute('aria-live', 'polite');
            setTimeout(function () { btn.textContent = old; }, 1500);
          } catch (e) {
            const old = btn.textContent;
            btn.textContent = 'Kunne ikke kopiere';
            setTimeout(function () { btn.textContent = old; }, 1500);
          }
        });
      });
    })();
    </script>
</body>
</html>